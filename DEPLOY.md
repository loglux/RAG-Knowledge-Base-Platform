# Production Deployment Guide

## üöÄ Quick Start (Recommended)

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:**

```bash
# Backend deployment (Python code changes)
./scripts/deploy_backend.sh

# Frontend deployment (React/TypeScript changes)
./scripts/deploy_frontend.sh
```

–≠—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞—é—Ç –±–µ–∑ –∫–µ—à–∞ (–∏–∑–±–µ–≥–∞—é—Ç –ø—Ä–æ–±–ª–µ–º —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –∫–æ–¥–æ–º)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –∏ –∑–∞–ø—É—Å–∫–∞—é—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å --env-file
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—é—Ç health status
- ‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç, —á—Ç–æ –Ω–æ–≤—ã–π –∫–æ–¥ –ø–æ–ø–∞–ª –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

---

## Container Management

### –í–ê–ñ–ù–û: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ --env-file —Ñ–ª–∞–≥!

–ü—Ä–∏ –ª—é–±—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å production –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** —É–∫–∞–∑—ã–≤–∞–π—Ç–µ `--env-file .env.production`, –∏–Ω–∞—á–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç—è—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –±—É–¥—É—Ç –æ—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

---

## –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### 1. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, frontend)

```bash
# –®–∞–≥ 1: –°–æ–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑
docker compose build frontend

# –®–∞–≥ 2: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose down

# –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å env —Ñ–∞–π–ª–æ–º
docker compose --env-file .env.production up -d
```

**–ù–ò–ö–û–ì–î–ê –ù–ï –î–ï–õ–ê–ô–¢–ï:**
```bash
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ env —Ñ–∞–π–ª–∞
docker compose up -d frontend
```

### 2. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ backend

```bash
# –®–∞–≥ 1: –°–æ–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑
docker compose build backend

# –®–∞–≥ 2: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose down

# –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å env —Ñ–∞–π–ª–æ–º
docker compose --env-file .env.production up -d
```

### 3. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –®–∞–≥ 1: –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –æ–±—Ä–∞–∑—ã
docker compose build

# –®–∞–≥ 2: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose down

# –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å env —Ñ–∞–π–ª–æ–º
docker compose --env-file .env.production up -d
```

### 4. –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏)

```bash
# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞
docker compose restart
```

**–ù–æ –µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è env —Ñ–∞–π–ª–∞:**
```bash
docker compose down
docker compose --env-file .env.production up -d
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose logs -f backend
docker compose logs -f frontend

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤
docker compose logs --tail 50 backend
```

---

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "password authentication failed for user kb_user"

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã –±–µ–∑ --env-file —Ñ–ª–∞–≥–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker compose down
docker compose --env-file .env.production up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–∑

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker compose build frontend
docker compose down
docker compose --env-file .env.production up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: Backend –Ω–µ –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ –∂–µ - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker compose build backend
docker compose down
docker compose --env-file .env.production up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–¥ –∏–∑–º–µ–Ω–∏–ª—Å—è, –ø–µ—Ä–µ—Å–æ–±—Ä–∞–ª–∏, –Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å—ë –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π –∫–æ–¥

**–ü—Ä–∏—á–∏–Ω–∞:** Docker layer caching - Docker –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ–π —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ --no-cache –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ
docker compose build --no-cache backend
docker compose down
docker compose --env-file .env.production up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–æ–≤—ã–π –∫–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
docker exec kb-platform-backend-prod grep -n "your_change" /app/path/to/file.py
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Docker –∫–µ—à–∏—Ä—É–µ—Ç —Å–ª–æ–∏ –æ–±—Ä–∞–∑–∞ –ø–æ timestamp/—Ä–∞–∑–º–µ—Ä—É —Ñ–∞–π–ª–æ–≤
- –ï—Å–ª–∏ Docker —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ —Ñ–∞–π–ª—ã –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π —Å–ª–æ–π
- `--no-cache` –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å–ª–æ–∏ –∑–∞–Ω–æ–≤–æ

**–ü—Ä–∞–≤–∏–ª–æ:** –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö Python/TypeScript –∫–æ–¥–∞ **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--no-cache`

---

## Local Docker (single stack)

```bash
docker compose up -d --build
```

**–í–∞–∂–Ω–æ:** –∫–æ–¥ "–∑–∞–ø–µ–∫–∞–µ—Ç—Å—è" –≤ –æ–±—Ä–∞–∑, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –Ω—É–∂–µ–Ω rebuild.

---

## üìö –ü–æ–Ω–∏–º–∞–Ω–∏–µ Docker –∫–æ–º–∞–Ω–¥

### –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É restart, rebuild, –∏ up

| –ö–æ–º–∞–Ω–¥–∞ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ü–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–¥? |
|---------|------------|-------------------|-------------------|
| `restart backend` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | –î–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π | ‚ùå –ù–ï–¢ |
| `build backend` | –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ | –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞ | ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å (–∫–µ—à) |
| `build --no-cache backend` | –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –∫–µ—à–∞ | **–í—Å–µ–≥–¥–∞** –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞ | ‚úÖ –î–ê |
| `up -d backend` | –°–æ–∑–¥–∞–µ—Ç/–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | –ü–æ—Å–ª–µ build | ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—Ä–∞–∑ |
| `up -d --force-recreate` | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç | –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ | ‚úÖ –î–ê (–µ—Å–ª–∏ rebuild –±—ã–ª) |

### –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω rebuild?

| –ò–∑–º–µ–Ω–µ–Ω–∏—è | Rebuild? | –ö–æ–º–∞–Ω–¥–∞ |
|-----------|----------|---------|
| Python –∫–æ–¥ (`app/**/*.py`) | ‚úÖ **–î–ê** | `build --no-cache backend` |
| TypeScript/React (`frontend/src/**`) | ‚úÖ **–î–ê** | `build --no-cache frontend` |
| `requirements.txt` | ‚úÖ **–î–ê** | `build --no-cache backend` |
| `package.json` | ‚úÖ **–î–ê** | `build --no-cache frontend` |
| Dockerfile | ‚úÖ **–î–ê** | `build --no-cache <service>` |
| `.env.production` | ‚ùå –ù–ï–¢ | `restart` —Å `--env-file` |
| `docker-compose.yml` | ‚ö†Ô∏è –ó–ê–í–ò–°–ò–¢ | `up -d` (–ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç) |

### –ü–æ—á–µ–º—É `--no-cache` –∫—Ä–∏—Ç–∏—á–µ–Ω?

Docker –∫–µ—à–∏—Ä—É–µ—Ç —Å–ª–æ–∏ –æ–±—Ä–∞–∑–∞. –ü—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. –ò–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ Dockerfile?
2. –ò–∑–º–µ–Ω–∏–ª–∏—Å—å –ª–∏ —Ñ–∞–π–ª—ã (–ø–æ timestamp/—Ä–∞–∑–º–µ—Ä—É)?

**–ü—Ä–æ–±–ª–µ–º–∞:** Docker –º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å, —á—Ç–æ —Ñ–∞–π–ª—ã –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π —Å–ª–æ–π —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –∫–æ–¥–æ–º.

**–†–µ—à–µ–Ω–∏–µ:** `--no-cache` –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç Docker –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –≤—Å–µ —Å–ª–æ–∏ –∑–∞–Ω–æ–≤–æ, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è —Å–≤–µ–∂–∏–π –∫–æ–¥.

### –ü–æ–ª–Ω—ã–π workflow –¥–ª—è code changes

```bash
# 1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ë–ï–ó –∫–µ—à–∞ (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
docker compose build --no-cache backend

# 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose --env-file .env.production stop backend

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –Ω–æ–≤—ã–º –æ–±—Ä–∞–∑–æ–º
docker compose --env-file .env.production up -d backend

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–¥ –æ–±–Ω–æ–≤–∏–ª—Å—è
docker exec kb-platform-backend-prod grep -n "your_recent_change" /app/path/to/file.py
```

**–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
```bash
./scripts/deploy_backend.sh   # –î–ª—è Python –∫–æ–¥–∞
./scripts/deploy_frontend.sh  # –î–ª—è React –∫–æ–¥–∞
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-02
